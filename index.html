<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>スロットゲーム</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link
		href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=M+PLUS+Rounded+1c:wght@700&display=swap"
		rel="stylesheet">
	<style>
		body {
			font-family: 'Inter', 'M PLUS Rounded 1c', sans-serif;
		}

		.slot-container {
			background: linear-gradient(145deg, #2a2a2a, #1e1e1e);
			box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3), inset 0 0 15px rgba(0, 0, 0, 0.5);
			border: 5px solid #444;
			border-top-color: #555;
			border-bottom-color: #333;
		}

		.reel {
			width: 100px;
			height: 120px;
			background-color: #1a1a1a;
			border: 3px solid #555;
			overflow: hidden;
			position: relative;
			box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.7);
		}

		.reel-inner {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			/* JavaScriptで動的にトランジションを設定します */
		}

		.symbol {
			width: 100%;
			height: 120px;
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 60px;
		}

		.spin-button {
			transition: all 0.2s ease-in-out;
			box-shadow: 0 5px 0 #c0392b;
		}

		.spin-button:active {
			transform: translateY(5px);
			box-shadow: 0 0 0 #c0392b;
		}

		.spin-button:disabled {
			background-color: #95a5a6;
			cursor: not-allowed;
			box-shadow: 0 5px 0 #7f8c8d;
		}

		.message-box {
			transition: all 0.3s ease-in-out;
		}

		.highlight {
			animation: highlight-animation 1s ease-in-out;
		}

		@keyframes highlight-animation {

			0%,
			100% {
				transform: scale(1);
				box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.7);
			}

			50% {
				transform: scale(1.05);
				box-shadow: 0 0 25px 10px #f1c40f;
			}
		}
	</style>
</head>

<body class="bg-gray-800 text-white flex items-center justify-center min-h-screen p-4">

	<div class="w-full max-w-md mx-auto">
		<h1 class="text-4xl font-bold text-center mb-2 text-yellow-400"
			style="font-family: 'M PLUS Rounded 1c', sans-serif;">スロットゲーム</h1>
		<div class="flex justify-between items-center bg-gray-900 px-4 py-2 rounded-t-lg">
			<div class="text-lg">
				<span>コイン: </span>
				<span id="coin-display" class="font-bold text-yellow-400">100</span>
			</div>
			<div class="text-lg">
				<span>ベット: </span>
				<span class="font-bold text-cyan-400">10</span>
			</div>
		</div>

		<!-- スロットマシンの本体 -->
		<div class="slot-container rounded-b-lg p-6 md:p-8">
			<!-- リール部分 -->
			<div class="flex justify-center space-x-4 mb-6">
				<div id="reel1" class="reel rounded-lg">
					<div class="reel-inner"></div>
				</div>
				<div id="reel2" class="reel rounded-lg">
					<div class="reel-inner"></div>
				</div>
				<div id="reel3" class="reel rounded-lg">
					<div class="reel-inner"></div>
				</div>
			</div>

			<!-- メッセージ表示エリア -->
			<div id="message-box"
				class="message-box text-center h-10 flex items-center justify-center text-xl font-bold mb-6 rounded-lg bg-gray-700/50">
				スピンボタンを押してね！
			</div>

			<!-- 操作ボタン -->
			<div class="flex justify-center">
				<button id="spin-button"
					class="spin-button w-full max-w-xs bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-4 rounded-lg text-2xl">
					スピン！
				</button>
			</div>
		</div>
	</div>

	<script>
		// DOM要素の取得
		const coinDisplay = document.getElementById('coin-display');
		const spinButton = document.getElementById('spin-button');
		const messageBox = document.getElementById('message-box');
		const reels = [
			document.querySelector('#reel1 .reel-inner'),
			document.querySelector('#reel2 .reel-inner'),
			document.querySelector('#reel3 .reel-inner')
		];

		// ゲームの設定
		const symbols = ['🍒', '🍋', '🍊', '🍉', '🔔', '⭐', '７'];
		const payouts = {
			'🍒': 20,
			'🍋': 30,
			'🍊': 40,
			'🍉': 50,
			'🔔': 100,
			'⭐': 200,
			'７': 500
		};
		const betAmount = 10;
		const symbolHeight = 120; // .symbolの高さと一致させる
		const blurSymbolsCount = 20; // 回転中に表示するシンボルの数

		// ゲームの状態
		let coins = 100;
		let isSpinning = false;

		// 初期化処理
		function init() {
			updateCoinDisplay();
			reels.forEach(reel => {
				reel.innerHTML = ''; // 中身をクリア
				reel.appendChild(createSymbolElement(getRandomSymbol()));
			});
		}

		// コイン表示を更新
		function updateCoinDisplay() {
			coinDisplay.textContent = coins;
		}

		// ランダムなシンボルを取得
		function getRandomSymbol() {
			return symbols[Math.floor(Math.random() * symbols.length)];
		}

		// シンボルを表示するDOM要素を作成
		function createSymbolElement(symbol) {
			const div = document.createElement('div');
			div.className = 'symbol';
			div.textContent = symbol;
			return div;
		}

		// スピン処理
		function spin() {
			if (isSpinning) return;
			if (coins < betAmount) {
				updateMessage("コインが足りません！", "text-red-500");
				return;
			}

			isSpinning = true;
			spinButton.disabled = true;
			spinButton.textContent = 'スピン中...';

			coins -= betAmount;
			updateCoinDisplay();
			updateMessage(" ", "text-white"); // メッセージをリセット

			const finalResults = [getRandomSymbol(), getRandomSymbol(), getRandomSymbol()];
			const longestDuration = (2 + (reels.length - 1) * 0.5) * 1000;

			reels.forEach((reel, i) => {
				// 1. 回転用のシンボルストリップを作成（結果が一番上、ダミーがその下）
				reel.innerHTML = '';
				// 最終的に表示されるシンボルを一番上に追加
				reel.appendChild(createSymbolElement(finalResults[i]));
				// 回転中に通り過ぎるダミーシンボルをその下に追加
				for (let j = 0; j < blurSymbolsCount; j++) {
					reel.appendChild(createSymbolElement(getRandomSymbol()));
				}

				// 2. アニメーション開始位置（一番下のダミーシンボルが見える位置）に設定
				reel.style.transition = 'none';
				const initialPosition = -(blurSymbolsCount * symbolHeight);
				reel.style.top = `${initialPosition}px`;

				// ブラウザにリセットを強制的に適用させる
				reel.offsetHeight;

				// 3. アニメーション（トランジション）を設定
				const spinDuration = 2 + i * 0.5; // リールごとに停止タイミングをずらす
				reel.style.transition = `top ${spinDuration}s cubic-bezier(0.25, 0.1, 0.25, 1)`; // イーズアウト（だんだん遅くなる）

				// 4. 最終的な停止位置（top: 0、一番上のシンボルが見える位置）を設定してアニメーションを開始
				reel.style.top = '0px';
			});

			// 全てのリールが停止した後に結果を判定
			setTimeout(() => {
				checkResult(finalResults);
			}, longestDuration);
		}

		// 結果を判定
		function checkResult(results) {
			const [r1, r2, r3] = results;
			const parentReels = reels.map(r => r.parentElement);

			parentReels.forEach(pr => pr.classList.remove('highlight'));

			if (r1 === r2 && r2 === r3) {
				const payout = payouts[r1];
				coins += payout;
				updateMessage(`大当たり！ ${payout}コイン獲得！`, "text-yellow-400");
				parentReels.forEach(pr => pr.classList.add('highlight'));
			} else {
				updateMessage("残念、はずれ...", "text-gray-400");
			}

			updateCoinDisplay();
			isSpinning = false;
			spinButton.disabled = false;
			spinButton.textContent = 'スピン！';

			if (coins < betAmount) {
				updateMessage("コインがなくなりました...", "text-red-500");
				spinButton.disabled = true;
			}

			// アニメーション後に不要な要素を削除してDOMを軽くする
			reels.forEach((reel, i) => {
				reel.style.transition = 'none';
				const finalSymbol = results[i];
				reel.innerHTML = ''; // 中身をクリア
				reel.appendChild(createSymbolElement(finalSymbol));
				reel.style.top = '0';
			});
		}

		// メッセージを更新
		function updateMessage(text, colorClass) {
			messageBox.textContent = text;
			messageBox.className = `message-box text-center h-10 flex items-center justify-center text-xl font-bold mb-6 rounded-lg bg-gray-700/50 ${colorClass}`;
		}

		// イベントリスナーを設定
		spinButton.addEventListener('click', spin);

		// ゲーム開始
		init();
	</script>
</body>

</html>