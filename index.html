<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>絵文字スロットゲーム</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700;900&display=swap" rel="stylesheet">
	<style>
		/* 全体のスタイル */
		body {
			font-family: 'M PLUS Rounded 1c', sans-serif;
			background-color: #1a2a3a;
			color: #ffffff;
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
			margin: 0;
			user-select: none;
		}

		/* ゲーム全体のコンテナ */
		#game-container {
			background: linear-gradient(45deg, #3a4a5a, #2a3a4a);
			border-radius: 20px;
			padding: 20px 30px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4), inset 0 2px 5px rgba(255, 255, 255, 0.1);
			border: 2px solid #5a6a7a;
			text-align: center;
			width: 90%;
			max-width: 400px;
		}

		/* ヘッダー部分 */
		header h1 {
			font-size: 2.5rem;
			font-weight: 900;
			color: #ffc107;
			text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
			margin: 0 0 10px 0;
		}

		/* コイン表示 */
		#credits-display {
			background-color: #111;
			color: #00ff00;
			font-size: 1.5rem;
			padding: 10px;
			border-radius: 10px;
			margin-bottom: 20px;
			border: 2px solid #444;
			box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
		}

		/* スロットマシン本体 */
		#slot-machine {
			display: flex;
			justify-content: center;
			gap: 10px;
			background-color: #000;
			padding: 15px;
			border-radius: 15px;
			border: 5px solid #888;
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
			margin-bottom: 20px;
		}

		/* 各リール */
		.reel {
			background-color: #fff;
			border: 2px solid #333;
			border-radius: 10px;
			overflow: hidden;
			width: 80px;
			height: 240px;
			/* 80px * 3セル分 */
			position: relative;
		}

		.reel-inner {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
		}

		/* 各マス */
		.cell {
			width: 80px;
			height: 80px;
			font-size: 50px;
			display: flex;
			justify-content: center;
			align-items: center;
			background-color: #fff;
			color: #333;
			border-bottom: 1px solid #ccc;
		}

		.cell:last-child {
			border-bottom: none;
		}

		/* 結果表示エリア */
		#result-display {
			height: 50px;
			font-size: 1.2rem;
			font-weight: bold;
			color: #ffeb3b;
			display: flex;
			justify-content: center;
			align-items: center;
			transition: all 0.3s ease;
		}

		/* スピンボタン */
		#spin-button {
			background: linear-gradient(180deg, #f44336, #d32f2f);
			color: white;
			font-size: 1.8rem;
			font-weight: 700;
			padding: 15px 40px;
			border: none;
			border-radius: 50px;
			cursor: pointer;
			box-shadow: 0 5px 0 #9a0007, 0 8px 15px rgba(0, 0, 0, 0.4);
			transition: all 0.1s ease-in-out;
		}

		#spin-button:disabled {
			background: #777;
			box-shadow: 0 5px 0 #444;
			cursor: not-allowed;
		}

		#spin-button:not(:disabled):active {
			transform: translateY(5px);
			box-shadow: 0 0px 0 #9a0007;
		}

		/* スピン中のアニメーション */
		.spinning .reel-inner {
			animation: scroll-reel 0.2s linear infinite;
		}

		@keyframes scroll-reel {
			from {
				transform: translateY(-50%);
			}

			to {
				transform: translateY(0);
			}
		}

		/* 当たったラインのハイライト */
		.winning-cell {
			animation: win-pulse 0.8s infinite;
		}

		@keyframes win-pulse {
			0% {
				transform: scale(1);
				background-color: #fff2ab;
			}

			50% {
				transform: scale(1.1);
				background-color: #ffc107;
			}

			100% {
				transform: scale(1);
				background-color: #fff2ab;
			}
		}
	</style>
</head>

<body>

	<div id="game-container">
		<header>
			<h1>絵文字スロット</h1>
			<div id="credits-display">コイン: 1000</div>
		</header>

		<main>
			<div id="slot-machine">
				<div class="reel" id="reel1"></div>
				<div class="reel" id="reel2"></div>
				<div class="reel" id="reel3"></div>
			</div>

			<div id="result-display">ボタンを押してスタート！</div>
			<button id="spin-button">スピン！</button>
		</main>
	</div>

	<script>
		// --- DOM要素の取得 ---
		const reelElements = [
			document.getElementById('reel1'),
			document.getElementById('reel2'),
			document.getElementById('reel3')
		];
		const spinButton = document.getElementById('spin-button');
		const creditsDisplay = document.getElementById('credits-display');
		const resultDisplay = document.getElementById('result-display');

		// --- ゲームの基本設定 ---

		// 各リールの絵柄の並び順（リールストリップ）
		// ブランク絵柄をなくし、当たりが出やすいように調整。
		// また、リールの並びはシャッフルせず、当たりが出やすいようにしつつも、
		// 高配当の絵柄が連続しないように手動で最適な並び順に調整している。
		const reel1 = [
			'🍒', '🍉', '🔔', 'BAR', '👑', '🍒', '🍉', '🔔', '🍒', 'BAR', '🍉', '🍒', '７', '🔔', '🍒', '🍉', 'BAR', '👑', '🔔', '🍒', '🍉'
		]; // 合計21マス
		const reel2 = [
			'BAR', '🍒', '🍉', '🔔', '👑', '🍒', '🍉', 'BAR', '🔔', '🍒', '７', '🍉', '🍒', '🔔', 'BAR', '👑', '🍒', '🍉', '🔔', '🍒', '🍉'
		]; // 合計21マス
		const reel3 = [
			'👑', 'BAR', '🍒', '🍉', '🔔', '🍒', '７', '🍉', 'BAR', '🔔', '🍒', '🍉', '👑', '🔔', '🍒', 'BAR', '🍉', '🔔', '🍒', '🍉', '🍒'
		]; // 合計21マス
		const reels = [reel1, reel2, reel3];

		// 配当表 (キーは揃った絵文字を連結した文字列)
		const payoutTable = {
			'７７７': 300,
			'👑👑👑': 100,
			'BARBARBAR': 80, // BARの役を追加
			'🔔🔔🔔': 50,
			'🍉🍉🍉': 20,
			'🍒🍒🍒': 10,
		};
		// チェリーは2つでも当たり
		const cherryPayout = {
			count2: 5,
			count1: 2, // 最初の1リール目のみ
		};

		// ゲームの状態
		let credits = 1000;
		const spinCost = 10;
		let isSpinning = false;

		// --- ゲームロジック ---

		/**
		 * 初期化処理
		 */
		function init() {
			updateCreditsDisplay();
			// 初期盤面をランダムに設定
			reels.forEach((reel, i) => {
				const stopIndex = Math.floor(Math.random() * reel.length);
				updateReelDisplay(i, stopIndex);
			});
		}

		/**
		 * スピンボタンが押されたときの処理
		 */
		async function handleSpin() {
			if (isSpinning || credits < spinCost) return;

			isSpinning = true;
			spinButton.disabled = true;
			resultDisplay.textContent = 'スピン中...';
			clearWinHighlights();

			// コインを消費
			credits -= spinCost;
			updateCreditsDisplay();

			// スピンアニメーション開始
			reelElements.forEach((reelEl, i) => {
				setupSpinningReel(i);
				reelEl.classList.add('spinning');
			});


			// 各リールを少しずつずらして停止させる
			const stopIndexes = [];
			for (let i = 0; i < reels.length; i++) {
				await new Promise(resolve => setTimeout(resolve, 200)); // 停止タイミングをずらし、時間を短縮
				const stopIndex = Math.floor(Math.random() * reels[i].length);
				stopIndexes.push(stopIndex);
				reelElements[i].classList.remove('spinning');
				updateReelDisplay(i, stopIndex);
			}

			// 当たり判定
			checkWin(stopIndexes);

			isSpinning = false;
			if (credits >= spinCost) {
				spinButton.disabled = false;
			} else {
				resultDisplay.textContent = 'コインが足りません！';
			}
		}

		/**
		 * スピン中のリールを準備する
		 * @param {number} reelIndex
		 */
		function setupSpinningReel(reelIndex) {
			const reel = reels[reelIndex];
			const reelEl = reelElements[reelIndex];
			reelEl.innerHTML = ''; // 中身をクリア

			const reelInner = document.createElement('div');
			reelInner.classList.add('reel-inner');

			// アニメーションが途切れないように、絵柄を2周分用意する
			const extendedSymbols = [...reel, ...reel];

			for (const symbol of extendedSymbols) {
				const cell = document.createElement('div');
				cell.classList.add('cell');
				cell.textContent = symbol;
				reelInner.appendChild(cell);
			}
			reelEl.appendChild(reelInner);
		}


		/**
		 * 当たり判定処理
		 * @param {number[]} stopIndexes - 3つのリールの停止位置
		 */
		function checkWin(stopIndexes) {
			const board = getBoard(stopIndexes);
			let totalWin = 0;

			// 当たりラインの定義 [ [リール0の行, リール1の行, リール2の行], ... ]
			const paylines = [
				[0, 0, 0], // 上段
				[1, 1, 1], // 中段
				[2, 2, 2], // 下段
				[0, 1, 2], // 右下がり斜め
				[2, 1, 0] // 右上がり斜め
			];

			const winningLines = [];
			let hasThreeOfAKind = false;

			// 5ラインの当たり判定
			paylines.forEach((line, lineIndex) => {
				const symbol1 = board[0][line[0]];
				const symbol2 = board[1][line[1]];
				const symbol3 = board[2][line[2]];

				if (symbol1 === symbol2 && symbol2 === symbol3) {
					const winKey = `${symbol1}${symbol2}${symbol3}`;
					if (payoutTable[winKey]) {
						totalWin += payoutTable[winKey];
						winningLines.push(lineIndex);
						if (symbol1 !== '🍒') { // チェリー以外の3つ揃いはフラグを立てる
							hasThreeOfAKind = true;
						}
					}
				}
			});

			// チェリーの特別判定 (3つ揃いの役がなかった場合のみ)
			if (!hasThreeOfAKind) {
				const cherryLine = [board[0][1], board[1][1], board[2][1]]; // 中段ラインのみで判定
				const cherryCount = cherryLine.filter(s => s === '🍒').length;

				if (totalWin === 0) { // 3つ揃いの役がなかった場合
					if (cherryCount === 2) {
						totalWin += cherryPayout.count2;
						if (!winningLines.includes(1)) winningLines.push(1);
					} else if (cherryLine[0] === '🍒' && cherryLine[1] !== '🍒' && cherryLine[2] !== '🍒') { // 1リール目中段のみチェリー
						totalWin += cherryPayout.count1;
						if (!winningLines.includes(1)) winningLines.push(1);
					}
				}
			}


			// 結果の表示とコインの更新
			if (totalWin > 0) {
				credits += totalWin;
				resultDisplay.textContent = `${totalWin}コイン GET!`;
				highlightWinningLines(winningLines);
			} else {
				resultDisplay.textContent = '残念！';
			}
			updateCreditsDisplay();
		}

		/**
		 * 現在の盤面を2次元配列で取得
		 * @param {number[]} stopIndexes - 3つのリールの停止位置
		 * @returns {string[][]} 3x3の盤面データ
		 */
		function getBoard(stopIndexes) {
			return stopIndexes.map((stopIndex, reelIndex) => {
				const reel = reels[reelIndex];
				const reelLength = reel.length;
				const top = reel[(stopIndex - 1 + reelLength) % reelLength];
				const middle = reel[stopIndex];
				const bottom = reel[(stopIndex + 1) % reelLength];
				return [top, middle, bottom];
			});
		}

		/**
		 * リールの表示を更新（停止時）
		 * @param {number} reelIndex - 更新するリールの番号 (0-2)
		 * @param {number} stopIndex - 停止する絵柄のインデックス
		 */
		function updateReelDisplay(reelIndex, stopIndex) {
			const reel = reels[reelIndex];
			const reelLength = reel.length;
			const reelEl = reelElements[reelIndex];

			reelEl.innerHTML = ''; // 中身をクリア

			const reelInner = document.createElement('div');
			reelInner.classList.add('reel-inner');

			const symbolsToShow = [
				reel[(stopIndex - 1 + reelLength) % reelLength],
				reel[stopIndex],
				reel[(stopIndex + 1) % reelLength],
			];

			for (const symbol of symbolsToShow) {
				const cell = document.createElement('div');
				cell.classList.add('cell');
				cell.textContent = symbol;
				reelInner.appendChild(cell);
			}
			reelEl.appendChild(reelInner);
		}

		/**
		 * コイン表示を更新
		 */
		function updateCreditsDisplay() {
			creditsDisplay.textContent = `コイン: ${credits}`;
		}

		/**
		 * 当たったラインをハイライトする
		 * @param {number[]} lineIndexes - 当たったペイラインのインデックスの配列
		 */
		function highlightWinningLines(lineIndexes) {
			const paylines = [
				[0, 0, 0], // 上段
				[1, 1, 1], // 中段
				[2, 2, 2], // 下段
				[0, 1, 2], // 右下がり斜め
				[2, 1, 0]  // 右上がり斜め
			];

			lineIndexes.forEach(lineIndex => {
				const line = paylines[lineIndex];
				line.forEach((cellRowIndex, reelIndex) => {
					const reelEl = reelElements[reelIndex];
					const cell = reelEl.querySelector(`.reel-inner .cell:nth-child(${cellRowIndex + 1})`);
					if (cell) {
						cell.classList.add('winning-cell');
					}
				});
			});
		}


		/**
		 * 全てのハイライトを消す
		 */
		function clearWinHighlights() {
			document.querySelectorAll('.winning-cell').forEach(el => {
				el.classList.remove('winning-cell');
			});
		}


		// --- イベントリスナー ---
		spinButton.addEventListener('click', handleSpin);

		// --- ゲーム開始 ---
		init();
	</script>
</body>

</html>